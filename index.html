<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NADIA | מרחב בטוח</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons (Loaded via script for React) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #f8fafc; /* Slate-50 */
            color: #1e293b; /* Slate-800 */
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Heebo', sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Chat Specifics */
        .message-bubble {
            position: relative;
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .message-user {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); /* Indigo */
            color: white;
            border-bottom-left-radius: 4px;
            margin-left: auto;
        }
        .message-bot {
            background: white;
            color: #334155;
            border-bottom-right-radius: 4px;
            margin-right: auto;
            border: 1px solid #e2e8f0;
        }
        
        /* Panic Button Pulse */
        .panic-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #ef4444;
            animation: ripple 1.5s infinite;
            z-index: -1;
        }
        @keyframes ripple {
            0% { width: 100%; height: 100%; opacity: 1; }
            100% { width: 200%; height: 200%; opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Mock Data & Icons ---
        
        // Simplified Icon Component using SVG paths directly for zero-dependency reliability
        // FIX: Wrapped multi-path icons in Fragments (<>...</>) to fix JSX SyntaxError
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
                zap: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />,
                book: <><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" /><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" /></>,
                messageCircle: <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />,
                logOut: <><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" y1="12" x2="9" y2="12" /></>,
                home: <><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></>,
                activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />,
                heart: <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />,
                phone: <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />,
                checkCircle: <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></>,
                alertTriangle: <><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></>,
                x: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
                menu: <><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></>,
                mail: <><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></>
            };

            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                >
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        // --- Safety Guard Component ---
        const SafetyGuard = () => {
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === 'Escape') {
                        window.location.replace("https://weather.com");
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            return null; // Invisible component
        };

        // --- Main Navigation ---
        const Navbar = ({ activeTab, setActiveTab, onPanic }) => {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            
            const navItems = [
                { id: 'dashboard', label: 'ראשי', icon: 'home' },
                { id: 'chat', label: 'התייעצות AI', icon: 'messageCircle' },
                { id: 'quiz', label: 'אבחון', icon: 'activity' },
                { id: 'glossary', label: 'מילון', icon: 'book' },
                { id: 'resources', label: 'עזרה', icon: 'heart' },
            ];

            return (
                <nav className="glass-nav fixed top-0 w-full z-40 h-16 transition-all duration-300">
                    <div className="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
                        {/* Logo */}
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setActiveTab('dashboard')}>
                            <div className="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center text-white">
                                <span className="font-bold text-lg">N</span>
                            </div>
                            <span className="font-heebo font-bold text-xl text-indigo-900 tracking-wide">NADIA</span>
                        </div>

                        {/* Desktop Nav */}
                        <div className="hidden md:flex items-center gap-1">
                            {navItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => setActiveTab(item.id)}
                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2
                                        ${activeTab === item.id 
                                            ? 'bg-indigo-50 text-indigo-700' 
                                            : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'}`}
                                >
                                    <Icon name={item.icon} size={16} />
                                    {item.label}
                                </button>
                            ))}
                        </div>

                        {/* Right Side: Panic & Mobile Menu */}
                        <div className="flex items-center gap-3">
                            <button 
                                onClick={onPanic}
                                className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg shadow-red-500/30 flex items-center gap-2 transition-transform active:scale-95 group relative overflow-hidden"
                            >
                                <span className="relative z-10 flex items-center gap-2">
                                    <Icon name="logOut" size={16} />
                                    <span className="hidden sm:inline">יציאה מהירה</span>
                                </span>
                            </button>

                            <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="md:hidden p-2 text-slate-600">
                                <Icon name={isMenuOpen ? "x" : "menu"} />
                            </button>
                        </div>
                    </div>

                    {/* Mobile Nav Drawer */}
                    {isMenuOpen && (
                        <div className="md:hidden absolute top-16 left-0 w-full bg-white/95 backdrop-blur-xl border-b border-slate-200 shadow-xl p-4 flex flex-col gap-2">
                             {navItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => { setActiveTab(item.id); setIsMenuOpen(false); }}
                                    className={`p-3 rounded-lg text-right font-medium flex items-center gap-3
                                        ${activeTab === item.id 
                                            ? 'bg-indigo-50 text-indigo-700' 
                                            : 'text-slate-600'}`}
                                >
                                    <Icon name={item.icon} size={18} />
                                    {item.label}
                                </button>
                            ))}
                        </div>
                    )}
                </nav>
            );
        };

        // --- Sections Components ---

        const Dashboard = ({ setActiveTab }) => {
            return (
                <div className="space-y-8 animate-fade-in pb-10">
                    {/* Hero */}
                    <div className="relative overflow-hidden rounded-3xl bg-gradient-to-r from-indigo-600 to-violet-600 text-white p-8 md:p-12 shadow-2xl shadow-indigo-200">
                        <div className="relative z-10 max-w-2xl">
                            <h1 className="text-3xl md:text-5xl font-black mb-4 leading-tight">
                                את לא לבד.<br/> אנחנו כאן להחזיר לך את הכוח.
                            </h1>
                            <p className="text-indigo-100 text-lg mb-8 max-w-lg">
                                פלטפורמה דיגיטלית בטוחה, דיסקרטית ומבוססת AI להתמודדות עם מערכות יחסים מורכבות.
                            </p>
                            <div className="flex flex-wrap gap-4">
                                <button onClick={() => setActiveTab('chat')} className="bg-white text-indigo-600 px-6 py-3 rounded-xl font-bold hover:bg-indigo-50 transition shadow-lg">
                                    התחילי שיחה
                                </button>
                                <button onClick={() => setActiveTab('quiz')} className="bg-indigo-700/50 backdrop-blur-md text-white border border-white/20 px-6 py-3 rounded-xl font-bold hover:bg-indigo-700/70 transition">
                                    האם הקשר שלי רעיל?
                                </button>
                            </div>
                        </div>
                        {/* Decorative Circles */}
                        <div className="absolute top-0 left-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
                        <div className="absolute bottom-0 right-0 w-96 h-96 bg-indigo-500/30 rounded-full blur-3xl translate-x-1/3 translate-y-1/3"></div>
                    </div>

                    {/* Stats */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        {[
                            { label: 'דיסקרטיות', val: '100%', icon: 'shield' },
                            { label: 'זמינות', val: '24/7', icon: 'zap' },
                            { label: 'אנונימיות', val: 'מלאה', icon: 'checkCircle' },
                            { label: 'טכנולוגיה', val: 'AI', icon: 'activity' },
                        ].map((stat, idx) => (
                            <div key={idx} className="glass-card p-4 rounded-2xl flex flex-col items-center text-center">
                                <div className="p-2 bg-indigo-50 rounded-full text-indigo-600 mb-2">
                                    <Icon name={stat.icon} size={20} />
                                </div>
                                <span className="text-2xl font-black text-slate-800">{stat.val}</span>
                                <span className="text-xs text-slate-500 font-medium">{stat.label}</span>
                            </div>
                        ))}
                    </div>

                    {/* Bento Grid Nav */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div onClick={() => setActiveTab('chat')} className="glass-card p-6 rounded-2xl cursor-pointer hover:scale-[1.02] transition-transform md:col-span-2 group relative overflow-hidden">
                            <div className="absolute inset-0 bg-gradient-to-br from-indigo-50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div className="relative z-10">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="bg-indigo-100 p-3 rounded-xl text-indigo-600">
                                        <Icon name="messageCircle" size={24} />
                                    </div>
                                    <span className="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-bold">פעיל כעת</span>
                                </div>
                                <h3 className="text-xl font-bold text-slate-800 mb-2">Nadia AI - היועצת האישית שלך</h3>
                                <p className="text-slate-600 text-sm">שוחחי עם בינה מלאכותית שתעזור לך לנתח הודעות, לפרוק רגשות, או לתרגל הצבת גבולות מול נרקיסיסט.</p>
                            </div>
                        </div>

                        <div onClick={() => setActiveTab('quiz')} className="glass-card p-6 rounded-2xl cursor-pointer hover:scale-[1.02] transition-transform group">
                            <div className="bg-rose-100 w-12 h-12 rounded-xl flex items-center justify-center text-rose-600 mb-4 group-hover:bg-rose-200 transition-colors">
                                <Icon name="alertTriangle" size={24} />
                            </div>
                            <h3 className="text-lg font-bold text-slate-800 mb-1">בדיקת רעילות</h3>
                            <p className="text-slate-500 text-xs">שאלון קצר המבוסס על סממנים קליניים לבדיקת טיב הקשר.</p>
                        </div>

                        <div onClick={() => setActiveTab('glossary')} className="glass-card p-6 rounded-2xl cursor-pointer hover:scale-[1.02] transition-transform">
                            <div className="bg-sky-100 w-12 h-12 rounded-xl flex items-center justify-center text-sky-600 mb-4">
                                <Icon name="book" size={24} />
                            </div>
                            <h3 className="text-lg font-bold text-slate-800 mb-1">הידע הוא כוח</h3>
                            <p className="text-slate-500 text-xs">מילון מושגים: גזלייטינג, הוברינג ועוד.</p>
                        </div>

                        <div onClick={() => setActiveTab('resources')} className="glass-card p-6 rounded-2xl cursor-pointer hover:scale-[1.02] transition-transform md:col-span-2">
                             <div className="flex items-center gap-4">
                                <div className="bg-emerald-100 w-12 h-12 rounded-xl flex items-center justify-center text-emerald-600">
                                    <Icon name="phone" size={24} />
                                </div>
                                <div>
                                    <h3 className="text-lg font-bold text-slate-800">עזרה דחופה</h3>
                                    <p className="text-slate-500 text-xs">קווי חירום, עמותות סיוע וטיפים לבטיחות דיגיטלית.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div onClick={() => setActiveTab('contact')} className="glass-card p-6 rounded-2xl cursor-pointer hover:scale-[1.02] transition-transform group">
                            <div className="bg-purple-100 w-12 h-12 rounded-xl flex items-center justify-center text-purple-600 mb-4 group-hover:bg-purple-200 transition-colors">
                                <Icon name="mail" size={24} />
                            </div>
                            <h3 className="text-lg font-bold text-slate-800 mb-1">צור קשר</h3>
                            <p className="text-slate-500 text-xs">פנייה דיסקרטית ומאובטחת לצוות האתר.</p>
                        </div>
                    </div>
                </div>
            );
        };

        const ChatInterface = () => {
            const [messages, setMessages] = useState([
                { id: 1, text: "שלום, אני נדיה. אני כאן בשבילך. את יכולה לבחור בין התייעצות תומכת לבין תרגול שיחה עם הצד השני. איך תרצי שנתקדם?", sender: 'bot', type: 'system' }
            ]);
            const [input, setInput] = useState("");
            const [mode, setMode] = useState("support"); // support | simulator
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(scrollToBottom, [messages]);

            const handleSend = async () => {
                if (!input.trim()) return;

                const newMsg = { id: Date.now(), text: input, sender: 'user' };
                setMessages(prev => [...prev, newMsg]);
                setInput("");
                setIsTyping(true);

                // --- API INTEGRATION PLACEHOLDER ---
                // Here you would call Google Gemini API.
                // const response = await callGeminiAPI(input, mode);
                
                // Simulating Network Delay & AI Processing
                setTimeout(() => {
                    let replyText = "";
                    if (mode === 'support') {
                        replyText = "אני שומעת כמה זה קשה. התחושה הזו שאת הולכת על ביצים מוכרת מאוד במצבים כאלו. האם קרה משהו ספציפי היום שגרם לך להרגיש ככה?";
                    } else {
                        // Simulator Mode (Narcissist Persona)
                        replyText = "וואו, באמת? שוב את מתחילה עם הדרמות שלך? אני עושה הכל בשבילך ואת רק מתלוננת. אולי הבעיה היא אצלך?";
                    }
                    
                    setMessages(prev => [...prev, { id: Date.now() + 1, text: replyText, sender: 'bot' }]);
                    setIsTyping(false);
                }, 2000);
            };

            return (
                <div className="flex flex-col h-[calc(100vh-140px)] animate-fade-in">
                    {/* Header / Mode Switcher */}
                    <div className="glass-card p-3 mb-4 rounded-xl flex justify-between items-center">
                        <div className="flex items-center gap-2">
                             <div className={`w-3 h-3 rounded-full ${mode === 'support' ? 'bg-indigo-500' : 'bg-orange-500'}`}></div>
                             <span className="font-bold text-sm text-slate-700">
                                {mode === 'support' ? 'מצב תמיכה ואמפתיה' : 'סימולטור (תרגול גבולות)'}
                             </span>
                        </div>
                        <button 
                            onClick={() => {
                                const newMode = mode === 'support' ? 'simulator' : 'support';
                                setMode(newMode);
                                setMessages(prev => [...prev, { 
                                    id: Date.now(), 
                                    text: newMode === 'support' 
                                        ? "עברתי למצב תמיכה. אני כאן להקשיב." 
                                        : "עברתי למצב סימולטור. אני אשחק את הצד השני כדי שתוכלי לתרגל אסרטיביות. כתבי לי הודעה...", 
                                    sender: 'bot', 
                                    type: 'system' 
                                }]);
                            }}
                            className="text-xs bg-slate-100 hover:bg-slate-200 px-3 py-1 rounded-lg transition"
                        >
                            החלף מצב
                        </button>
                    </div>

                    {/* Chat Area */}
                    <div className="flex-1 overflow-y-auto space-y-4 p-2 scroll-smooth">
                        {messages.map((msg) => (
                            <div key={msg.id} className={`flex w-full ${msg.type === 'system' ? 'justify-center' : ''}`}>
                                {msg.type === 'system' ? (
                                    <span className="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded-full">{msg.text}</span>
                                ) : (
                                    <div className={`message-bubble ${msg.sender === 'user' ? 'message-user' : 'message-bot'}`}>
                                        {msg.text}
                                    </div>
                                )}
                            </div>
                        ))}
                        {isTyping && (
                            <div className="flex w-full">
                                <div className="message-bubble message-bot flex gap-1 items-center py-4">
                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></div>
                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75"></div>
                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150"></div>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    {/* Input Area */}
                    <div className="mt-4 relative">
                        <input
                            type="text"
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                            placeholder="הקלידי הודעה..."
                            className="w-full glass-card pl-12 pr-4 py-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm transition-shadow"
                        />
                        <button 
                            onClick={handleSend}
                            className="absolute left-2 top-2 bottom-2 bg-indigo-600 text-white w-10 h-10 rounded-lg flex items-center justify-center hover:bg-indigo-700 transition"
                        >
                            <Icon name="messageCircle" size={20} className="rtl:rotate-180" />
                        </button>
                    </div>
                </div>
            );
        };

        const Quiz = () => {
            const [activeQuestion, setActiveQuestion] = useState(0);
            const [score, setScore] = useState(0);
            const [finished, setFinished] = useState(false);

            const questions = [
                "האם את/ה מרגיש/ה שאת/ה הולכ/ת על ביצים ליד בן/בת הזוג?",
                "האם את/ה חווה שינויים קיצוניים ביחס כלפייך (הרעפת אהבה ואז קרירות מוחלטת)?",
                "האם גורמים לך לפקפק בזיכרון שלך או בשפיות שלך (Gaslighting)?",
                "האם יש ניסיון לבודד אותך מחברים או משפחה?",
                "האם את/ה מרגיש/ה שאת/ה תמיד אשמ/ה, גם כשלא עשית כלום?"
            ];

            const handleAnswer = (val) => {
                setScore(score + val);
                if (activeQuestion < questions.length - 1) {
                    setActiveQuestion(activeQuestion + 1);
                } else {
                    setFinished(true);
                }
            };

            return (
                <div className="max-w-2xl mx-auto pt-10 animate-fade-in">
                    {!finished ? (
                        <div className="glass-card p-8 rounded-3xl text-center">
                            <div className="mb-8">
                                <span className="text-indigo-600 text-sm font-bold tracking-widest uppercase">שאלה {activeQuestion + 1} מתוך {questions.length}</span>
                                <div className="w-full bg-slate-200 h-2 rounded-full mt-2">
                                    <div className="bg-indigo-600 h-2 rounded-full transition-all duration-500" style={{ width: `${((activeQuestion + 1) / questions.length) * 100}%` }}></div>
                                </div>
                            </div>
                            <h2 className="text-2xl font-bold mb-10 leading-relaxed text-slate-800">{questions[activeQuestion]}</h2>
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <button onClick={() => handleAnswer(0)} className="border-2 border-slate-200 p-4 rounded-xl hover:bg-slate-50 font-bold text-slate-600 transition">לא, אף פעם</button>
                                <button onClick={() => handleAnswer(1)} className="border-2 border-indigo-100 p-4 rounded-xl hover:bg-indigo-50 font-bold text-indigo-600 transition">לפעמים</button>
                                <button onClick={() => handleAnswer(2)} className="bg-indigo-600 text-white p-4 rounded-xl hover:bg-indigo-700 font-bold shadow-lg shadow-indigo-200 transition">כן, לעיתים קרובות</button>
                            </div>
                        </div>
                    ) : (
                        <div className="glass-card p-8 rounded-3xl text-center border-t-4 border-indigo-500">
                            <div className="inline-block p-4 bg-indigo-50 rounded-full text-indigo-600 mb-4">
                                <Icon name="activity" size={40} />
                            </div>
                            <h2 className="text-3xl font-bold mb-4">תוצאות האבחון</h2>
                            <p className="text-lg text-slate-600 mb-6">
                                {score > 6 
                                    ? "התשובות שלך מצביעות על סימנים מובהקים למערכת יחסים רעילה ואף נרקיסיסטית. חשוב מאוד שתדעי שזו לא אשמתך."
                                    : "ישנם מספר דגלים אדומים שעלו בתשובותייך. כדאי לשים לב לדינמיקה ולהציב גבולות."}
                            </p>
                            <div className="p-4 bg-yellow-50 border border-yellow-100 rounded-xl text-yellow-800 text-sm mb-6">
                                * שאלון זה אינו מחליף ייעוץ מקצועי ונועד להכוונה בלבד.
                            </div>
                            <button className="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-indigo-700 transition w-full shadow-lg">
                                קבלי המלצות לפעולה
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const Glossary = () => {
            const terms = [
                { title: "גזלייטינג (Gaslighting)", desc: "מניפולציה שגורמת לקורבן לפקפק במציאות, בזיכרון או בשפיות שלו." },
                { title: "הפצצת אהבה (Love Bombing)", desc: "העפת מחמאות, מתנות ותשומת לב מוגזמת בתחילת הקשר כדי ליצור תלות רגשית מהירה." },
                { title: "הוברינג (Hoovering)", desc: "ניסיונות 'לשאוב' את הקורבן חזרה לקשר אחרי פרידה, לרוב באמצעות הבטחות שווא לשינוי." },
                { title: "קופים מעופפים", desc: "אנשים שהנרקיסיסט מגייס לצדו כדי להפעיל לחץ על הקורבן או להכפיש את שמו." },
                { title: "טיפול בשתיקה", desc: "התעלמות מוחלטת מהקורבן כעונש או כאמצעי שליטה." },
                { title: "השלכה (Projection)", desc: "כשהנרקיסיסט מאשים אותך בתכונות או מעשים שליליים שהוא עצמו עושה." },
            ];

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in pb-10">
                    {terms.map((term, idx) => (
                        <div key={idx} className="glass-card p-6 rounded-2xl hover:shadow-xl transition-all duration-300 border-t-4 border-indigo-400">
                            <h3 className="text-xl font-bold text-indigo-900 mb-3">{term.title}</h3>
                            <p className="text-slate-600 leading-relaxed text-sm">{term.desc}</p>
                        </div>
                    ))}
                </div>
            );
        };

        const Resources = () => {
            return (
                <div className="max-w-3xl mx-auto space-y-8 animate-fade-in pb-10">
                    <div className="bg-rose-50 border border-rose-100 p-6 rounded-2xl flex items-start gap-4 shadow-sm">
                        <div className="text-rose-500 mt-1"><Icon name="alertTriangle" /></div>
                        <div>
                            <h3 className="text-lg font-bold text-rose-800 mb-1">מצב חירום?</h3>
                            <p className="text-rose-700 text-sm mb-4">אם את חשה סכנה מיידית לעצמך או לילדייך, אל תהססי.</p>
                            <div className="flex flex-wrap gap-3">
                                <a href="tel:100" className="bg-rose-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-rose-700 transition">משטרה 100</a>
                                <a href="tel:118" className="bg-white text-rose-600 border border-rose-200 px-4 py-2 rounded-lg font-bold text-sm hover:bg-rose-50 transition">מוקד רווחה 118</a>
                                <a href="tel:1201" className="bg-white text-rose-600 border border-rose-200 px-4 py-2 rounded-lg font-bold text-sm hover:bg-rose-50 transition">ער"ן 1201</a>
                            </div>
                        </div>
                    </div>

                    <div className="glass-card p-8 rounded-2xl">
                        <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                            <Icon name="shield" className="text-indigo-600" />
                            בטיחות דיגיטלית
                        </h3>
                        <ul className="space-y-4">
                            <li className="flex items-start gap-3">
                                <span className="bg-indigo-100 text-indigo-600 p-1 rounded font-bold text-xs mt-1">1</span>
                                <div className="text-sm text-slate-600">
                                    <strong>מחיקת היסטוריה:</strong> לאחר השימוש באתר, לחצי על Ctrl+H ומחקי את היסטוריית הגלישה של השעה האחרונה.
                                </div>
                            </li>
                            <li className="flex items-start gap-3">
                                <span className="bg-indigo-100 text-indigo-600 p-1 rounded font-bold text-xs mt-1">2</span>
                                <div className="text-sm text-slate-600">
                                    <strong>גלישה בסתר:</strong> השתמשי תמיד במצב Incognito (מצב גלישה בסתר) כשאת גולשת כאן.
                                </div>
                            </li>
                            <li className="flex items-start gap-3">
                                <span className="bg-indigo-100 text-indigo-600 p-1 rounded font-bold text-xs mt-1">3</span>
                                <div className="text-sm text-slate-600">
                                    <strong>סיסמאות:</strong> אם יש לך חשש שיש לבן הזוג גישה לטלפון שלך, החליפי סיסמאות במכשיר בטוח אחר.
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            );
        };
        
        const Contact = () => {
            const [formData, setFormData] = useState({ name: '', email: '', message: '', urgent: false });
            const [status, setStatus] = useState('idle');

            const handleSubmit = (e) => {
              e.preventDefault();
              setStatus('submitting');
              setTimeout(() => {
                setStatus('success');
                setFormData({ name: '', email: '', message: '', urgent: false });
                setTimeout(() => setStatus('idle'), 5000);
              }, 1500);
            };

            return (
              <div className="max-w-2xl mx-auto animate-fade-in">
                 <div className="glass-card p-6 rounded-2xl">
                   <div className="flex items-center gap-2 mb-4">
                       <Icon name="mail" className="text-indigo-600" size={24} />
                       <h2 className="text-2xl font-bold text-slate-800">צור קשר דיסקרטי</h2>
                   </div>
                   <p className="text-slate-500 mb-6">פנייה מאובטחת לצוות האתר.</p>
                   
                   {status === 'success' ? (
                     <div className="text-center py-10">
                       <div className="w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-200">
                         <Icon name="checkCircle" size={32} />
                       </div>
                       <h3 className="text-xl font-bold text-slate-800 mb-2">ההודעה נשלחה בהצלחה</h3>
                       <p className="text-slate-600">אנו נעשה את מירב המאמצים לענות בהקדם האפשרי.<br/>אם השארת מייל, התשובה תגיע לשם.</p>
                       <button className="mt-6 px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-slate-700 transition" onClick={() => setStatus('idle')}>שלח הודעה נוספת</button>
                     </div>
                   ) : (
                     <form onSubmit={handleSubmit} className="space-y-4">
                       <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <div>
                            <label className="block text-sm text-slate-600 mb-1">שם (אופציונלי)</label>
                            <input 
                              type="text"
                              className="w-full rounded-xl bg-slate-50 border border-slate-200 px-4 py-2.5 outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all"
                              placeholder="אפשר להישאר אנונימי" 
                              value={formData.name}
                              onChange={(e) => setFormData({...formData, name: e.target.value})}
                            />
                         </div>
                         <div>
                            <label className="block text-sm text-slate-600 mb-1">אימייל לחזרה (אופציונלי)</label>
                            <input 
                              type="email"
                              className="w-full rounded-xl bg-slate-50 border border-slate-200 px-4 py-2.5 outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all"
                              placeholder="רק אם תרצה/י תשובה" 
                              value={formData.email}
                              onChange={(e) => setFormData({...formData, email: e.target.value})}
                            />
                         </div>
                       </div>
                       
                       <div>
                         <label className="block text-sm text-slate-600 mb-1">ההודעה שלך</label>
                         <textarea 
                           required
                           className="w-full rounded-xl bg-slate-50 border border-slate-200 px-4 py-2.5 outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all h-32 resize-none"
                           placeholder="כתוב/כתבי כאן..."
                           value={formData.message}
                           onChange={(e) => setFormData({...formData, message: e.target.value})}
                         ></textarea>
                       </div>

                       <label className="flex items-center gap-3 p-3 rounded-xl bg-slate-50 border border-slate-200 cursor-pointer hover:bg-slate-100 transition">
                         <input 
                           type="checkbox" 
                           className="w-5 h-5 accent-red-500 rounded"
                           checked={formData.urgent}
                           onChange={(e) => setFormData({...formData, urgent: e.target.checked})}
                         />
                         <span className="text-sm text-slate-600">סימון כדחוף (דורש תשומת לב מיוחדת)</span>
                       </label>

                       <div className="pt-2">
                         <button type="submit" disabled={status === 'submitting'} className="bg-indigo-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-indigo-700 transition w-full md:w-auto disabled:opacity-70">
                           {status === 'submitting' ? 'שולח...' : 'שלח הודעה'}
                         </button>
                       </div>
                       
                       <p className="text-xs text-slate-400 text-center mt-4">
                         * במקרה חירום וסכנת חיים מיידית, אין להשתמש בטופס זה אלא לפנות למשטרה (100).
                       </p>
                     </form>
                   )}
                 </div>
              </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');

            const handlePanic = () => {
                // Immediate redirection to Google
                window.location.href = "https://www.google.com";
            };

            const renderContent = () => {
                switch(activeTab) {
                    case 'dashboard': return <Dashboard setActiveTab={setActiveTab} />;
                    case 'chat': return <ChatInterface />;
                    case 'quiz': return <Quiz />;
                    case 'glossary': return <Glossary />;
                    case 'resources': return <Resources />;
                    case 'contact': return <Contact />;
                    default: return <Dashboard />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 relative pb-20 md:pb-0">
                    {/* Background Ambient Gradients */}
                    <div className="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-200/20 rounded-full blur-[100px]"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-emerald-200/20 rounded-full blur-[100px]"></div>
                    </div>

                    <SafetyGuard />
                    <Navbar activeTab={activeTab} setActiveTab={setActiveTab} onPanic={handlePanic} />
                    
                    <main className="max-w-7xl mx-auto px-4 pt-24 pb-8 min-h-screen">
                        {renderContent()}
                    </main>

                    {/* Footer Warning */}
                    <footer className="fixed bottom-0 left-0 w-full bg-slate-900 text-slate-400 text-center py-2 text-xs z-30 hidden md:block">
                        האתר מספק מידע ותמיכה ראשונית ואינו מהווה תחליף לייעוץ משפטי או טיפול פסיכולוגי מקצועי. במקרה חירום יש לפנות למוקד 100.
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
