<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>נדיה - הזכות להיות אני</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Rubik', sans-serif;
            background-color: #f8fafc;
        }
        .gradient-text {
            background: linear-gradient(to left, #2563eb, #0891b2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Icons Components ---
        const MenuIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>;
        const XIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const BrainIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>;
        const MaskIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12c0 5.523 4.477 10 10 10s10-4.477 10-10S17.523 2 12 2 2 6.477 2 12z"/><path d="M15 9h.01"/><path d="M9 9h.01"/><path d="M12 16a4 4 0 0 1-4-2.5"/><path d="M16 13.5a4 4 0 0 1-4 2.5"/></svg>;
        const HeartCrackIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="m12 13-3-3"/><path d="m12 13 3-3"/></svg>;
        const ShieldIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const MessageCircleIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></svg>;
        const ArrowRightIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>;
        const ZapIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const MailIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>;
        const SparklesIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>;
        const BotIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>;
        const SettingsIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
        const ChevronUpIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 15-6-6-6 6"/></svg>;

        // --- Data ---
        const topics = [
            { id: 1, title: "הפצצת אהבה (Love Bombing)", description: "השלב הראשון במערכת היחסים. הנרקיסיסט מרעיף על הקורבן מחמאות מוגזמות, מתנות, ותשומת לב אינטנסיבית כדי ליצור תלות רגשית מהירה.", icon: <HeartCrackIcon />, category: "טקטיקות" },
            { id: 2, title: "גזלייטינג (Gaslighting)", description: "מניפולציה פסיכולוגית שנועדה לגרום לקורבן לפקפק בשפיותו, בזיכרון שלו ובתפיסת המציאות שלו ('זה לא קרה', 'אתה מדמיין').", icon: <BrainIcon />, category: "מניפולציה" },
            { id: 3, title: "חוסר אמפתיה", description: "סימן היכר מרכזי. חוסר יכולת או רצון אמיתי להבין את רגשותיו של האחר ולהזדהות עמם. האחר נתפס כאובייקט לסיפוק צרכים.", icon: <MaskIcon />, category: "תכונת ליבה" },
            { id: 4, title: "הפחתת ערך (Devaluation)", description: "לאחר שלב האידיאליזציה, הנרקיסיסט מתחיל לבקר, לזלזל ולהקטין את הקורבן באופן שיטתי כדי לערער את הביטחון העצמי שלו.", icon: <ZapIcon />, category: "מעגל הפגיעה" },
            { id: 5, title: "אספקה נרקיסיסטית", description: "ה'דלק' של הנרקיסיסט. צורך אובססיבי בהערצה, אישור ותשומת לב (חיובית או שלילית) כדי לתחזק את האגו השביר.", icon: <MessageCircleIcon />, category: "מניע" },
            { id: 6, title: "שילוש (Triangulation)", description: "הכנסת אדם שלישי (אמיתי או דמיוני) לתוך הדינמיקה הזוגית כדי ליצור קנאה, חוסר ביטחון ותחרותיות אצל הקורבן.", icon: <ArrowRightIcon />, category: "מניפולציה" },
            { id: 7, title: "שיטת האבן האפורה", description: "טכניקת התמודדות: להפוך ל'משעמם' כמו אבן אפורה. לא להגיב רגשית לפרובוקציות, לענות במונוטוניות ולמנוע מהם אספקה.", icon: <ShieldIcon />, category: "התמודדות" },
            { id: 8, title: "הקופים המעופפים", description: "אנשים שהנרקיסיסט מגייס לצדו (באמצעות שקרים ומניפולציות) כדי לפגוע בקורבן, לרגל אחריו או להפיץ עליו שמועות.", icon: <MaskIcon />, category: "סביבה" }
        ];

        const faqs = [
            { q: "למה הם עושים את זה?", a: "בבסיס ההפרעה עומדת תחושת ערך עצמי נמוכה מאוד וריקות פנימית. ההתנהגות הגרנדיוזית והמניפולטיבית היא מנגנון הגנה שנועד לפצות על בושה עמוקה ולשמור על תחושת עליונות מדומיין." },
            { q: "האם נרקיסיסט יכול להשתנות?", a: "זה נדיר מאוד. שינוי דורש מודעות עצמית עמוקה, לקיחת אחריות ורצון להשתנות – תכונות שחסרות לרוב אצל בעלי הפרעת אישיות נרקיסיסטית. טיפול לרוב לא עוזר אלא אם כן האדם מגיע למשבר קיצוני." },
            { q: "איך מזהים נרקיסיסט סמוי?", a: "נרקיסיסט סמוי נראה ביישן, רגיש ומופנם, אך עדיין בעל תחושת מגיע לי (Entitlement) גבוהה, רגישות קיצונית לביקורת, ופאסיב-אגרסיביות. הם ישחקו את תפקיד 'הקורבן הנצחי' כדי להשיג תשומת לב." }
        ];

        // --- Shared State Context ---
        const AppContext = React.createContext();

        // --- Components ---

        const Header = () => {
            const [isOpen, setIsOpen] = React.useState(false);
            const { setShowSettings } = React.useContext(AppContext);

            return (
                <nav className="bg-white shadow-md sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between h-16" dir="rtl">
                            <div className="flex items-center">
                                <span className="text-xl md:text-2xl font-bold gradient-text flex items-center gap-2">
                                    <ShieldIcon /> נדיה
                                </span>
                            </div>
                            
                            {/* Desktop Menu */}
                            <div className="hidden md:flex items-center gap-6">
                                <a href="#about" className="text-gray-600 hover:text-blue-600 font-medium transition">אודות</a>
                                <a href="#topics" className="text-gray-600 hover:text-blue-600 font-medium transition">נושאים</a>
                                <a href="#ai-tools" className="text-indigo-600 hover:text-indigo-800 font-bold transition flex items-center gap-1">
                                    <SparklesIcon /> כלים חכמים
                                </a>
                                <a href="#faq" className="text-gray-600 hover:text-blue-600 font-medium transition">שאלות נפוצות</a>
                                <a href="#contact" className="bg-blue-600 text-white px-5 py-2 rounded-full hover:bg-blue-700 transition flex items-center gap-2 text-sm">
                                    <MailIcon /> יצירת קשר
                                </a>
                                <button onClick={() => setShowSettings(true)} className="text-gray-500 hover:text-gray-800 transition p-2" title="הגדרות API">
                                    <SettingsIcon />
                                </button>
                            </div>

                            {/* Mobile menu button */}
                            <div className="md:hidden flex items-center gap-2">
                                <button onClick={() => setShowSettings(true)} className="text-gray-500 p-2">
                                    <SettingsIcon />
                                </button>
                                <button onClick={() => setIsOpen(!isOpen)} className="text-gray-600 hover:text-blue-600">
                                    {isOpen ? <XIcon /> : <MenuIcon />}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Mobile Menu */}
                    {isOpen && (
                        <div className="md:hidden bg-white border-t p-4">
                            <div className="flex flex-col gap-4">
                                <a href="#about" className="text-gray-700 hover:text-blue-600" onClick={()=>setIsOpen(false)}>אודות</a>
                                <a href="#topics" className="text-gray-700 hover:text-blue-600" onClick={()=>setIsOpen(false)}>נושאים ומושגים</a>
                                <a href="#ai-tools" className="text-indigo-600 font-bold" onClick={()=>setIsOpen(false)}>✨ כלים חכמים</a>
                                <a href="#faq" className="text-gray-700 hover:text-blue-600" onClick={()=>setIsOpen(false)}>שאלות נפוצות</a>
                                <a href="#contact" className="text-blue-600 font-medium" onClick={()=>setIsOpen(false)}>יצירת קשר</a>
                            </div>
                        </div>
                    )}
                </nav>
            );
        };

        const SettingsModal = () => {
            const { showSettings, setShowSettings, apiKey, setApiKey, contactEmail, setContactEmail } = React.useContext(AppContext);
            const [localKey, setLocalKey] = React.useState(apiKey);
            const [localEmail, setLocalEmail] = React.useState(contactEmail);

            React.useEffect(() => {
                setLocalKey(apiKey);
                setLocalEmail(contactEmail);
            }, [apiKey, contactEmail]);

            const handleSave = () => {
                setApiKey(localKey);
                setContactEmail(localEmail);
                setShowSettings(false);
            };

            if (!showSettings) return null;

            return (
                <div className="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 animate-fadeIn" dir="rtl">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <SettingsIcon /> הגדרות אתר
                            </h3>
                            <button onClick={() => setShowSettings(false)} className="text-slate-400 hover:text-slate-600">
                                <XIcon />
                            </button>
                        </div>
                        
                        <div className="space-y-6">
                            {/* Gemini API Section */}
                            <div className="space-y-2 border-b border-slate-100 pb-4">
                                <h4 className="font-bold text-slate-700 text-sm flex items-center gap-2">
                                    <SparklesIcon /> הגדרות בינה מלאכותית
                                </h4>
                                <p className="text-slate-500 text-xs">
                                    כדי להשתמש בכלי הניתוח, הזן מפתח Gemini API.
                                </p>
                                <input 
                                    type="password" 
                                    value={localKey}
                                    onChange={(e) => setLocalKey(e.target.value)}
                                    placeholder="הדבק את המפתח (API Key) כאן..."
                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-left"
                                    dir="ltr"
                                />
                                <div className="text-xs text-blue-600">
                                    <a href="https://aistudio.google.com/app/apikey" target="_blank" className="hover:underline">קבל מפתח בחינם מכאן &larr;</a>
                                </div>
                            </div>

                            {/* Contact Email Section */}
                            <div className="space-y-2">
                                <h4 className="font-bold text-slate-700 text-sm flex items-center gap-2">
                                    <MailIcon /> הגדרות טופס יצירת קשר
                                </h4>
                                <p className="text-slate-500 text-xs">
                                    לאיזה מייל תרצה שההודעות מהאתר יגיעו?
                                </p>
                                <input 
                                    type="email" 
                                    value={localEmail}
                                    onChange={(e) => setLocalEmail(e.target.value)}
                                    placeholder="your-email@example.com"
                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-left"
                                    dir="ltr"
                                />
                                <p className="text-[10px] text-slate-400">
                                    * בפעם הראשונה שתשלח הודעה, תקבל מייל אישור משירות FormSubmit.
                                </p>
                            </div>

                            <button 
                                onClick={handleSave}
                                className="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-500/20"
                            >
                                שמור שינויים
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Hero = () => {
            return (
                <div id="about" className="relative bg-slate-900 text-white py-20 overflow-hidden">
                    <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                    <div className="max-w-4xl mx-auto px-6 text-center relative z-10">
                        <h1 className="text-4xl md:text-6xl font-bold mb-6">נדיה - הזכות להיות אני</h1>
                        <p className="text-xl md:text-2xl text-slate-300 mb-8 font-light">
                            המדריך המלא להבנת נרקיסיזם, זיהוי דגלים אדומים וכלי AI חכמים להתמודדות.
                        </p>
                        <div className="flex justify-center gap-4">
                            <a href="#ai-tools" className="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg font-semibold transition shadow-lg shadow-indigo-500/30 flex items-center gap-2">
                                <SparklesIcon /> נסה את כלי ה-AI
                            </a>
                            <a href="#topics" className="bg-slate-700 hover:bg-slate-600 text-white px-8 py-3 rounded-lg font-semibold transition">
                                התחל לקרוא
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        const TopicCard = ({ item }) => {
            return (
                <div className="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-slate-100 flex flex-col h-full">
                    <div className="p-6 flex-1">
                        <div className="flex items-center justify-between mb-4">
                            <div className="p-3 bg-blue-50 text-blue-600 rounded-lg">
                                {item.icon}
                            </div>
                            <span className="text-xs font-bold text-slate-400 uppercase tracking-wider bg-slate-100 px-2 py-1 rounded">
                                {item.category}
                            </span>
                        </div>
                        <h3 className="text-xl font-bold text-slate-800 mb-3">{item.title}</h3>
                        <p className="text-slate-600 leading-relaxed text-sm">
                            {item.description}
                        </p>
                    </div>
                </div>
            );
        };

        const TopicsSection = () => {
            return (
                <section id="topics" className="py-20 bg-slate-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="text-center mb-16">
                            <h2 className="text-3xl font-bold text-slate-900 mb-4">מושגי יסוד ודפוסי התנהגות</h2>
                            <p className="text-slate-600 max-w-2xl mx-auto">
                                ידע הוא כוח. ככל שתבינו טוב יותר את הטקטיקות, כך השפעתן עליכם תפחת.
                                להלן המושגים החשובים ביותר שצריך להכיר.
                            </p>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            {topics.map(topic => (
                                <TopicCard key={topic.id} item={topic} />
                            ))}
                        </div>
                    </div>
                </section>
            );
        };

        const AIToolsSection = () => {
            const [input, setInput] = React.useState("");
            const [result, setResult] = React.useState("");
            const [loading, setLoading] = React.useState(false);
            const [activeTab, setActiveTab] = React.useState("analyze");
            const { apiKey, setShowSettings } = React.useContext(AppContext);

            const callGeminiAPI = async (prompt) => {
                if (!apiKey) {
                    setShowSettings(true);
                    return "אנא הזן מפתח API בהגדרות כדי להשתמש בכלי זה.";
                }

                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'API Error');
                    }
                    
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    return "שגיאה: המפתח אינו תקין או שיש בעיית תקשורת. בדוק את המפתח בהגדרות.";
                }
            };

            const handleAnalyze = async () => {
                if (!input.trim()) return;
                setLoading(true);
                setResult("");
                
                const prompt = `
                    You are an expert on narcissism and emotional manipulation. 
                    Analyze the following text (which is a message received by the user) in Hebrew.
                    Identify potential manipulation tactics such as Gaslighting, Guilt Tripping, Projection, Word Salad, or Love Bombing.
                    Be empathetic but objective. Explain WHY it is manipulative.
                    Text to analyze: "${input}"
                    Output language: Hebrew.
                `;
                
                const text = await callGeminiAPI(prompt);
                setResult(text);
                setLoading(false);
            };

            const handleGreyRock = async () => {
                if (!input.trim()) return;
                setLoading(true);
                setResult("");

                const prompt = `
                    The user wants to use the "Grey Rock" method to respond to a narcissist.
                    The Grey Rock method involves being uninteresting, unreactive, and boring to deny the narcissist "supply".
                    Based on the following context or received message, generate 3 optional responses in Hebrew.
                    The responses should be brief, neutral, emotionless, and firm.
                    Context/Message: "${input}"
                    Output format: Bullet points in Hebrew.
                `;

                const text = await callGeminiAPI(prompt);
                setResult(text);
                setLoading(false);
            };

            return (
                <section id="ai-tools" className="py-20 bg-gradient-to-br from-indigo-900 to-slate-900 text-white relative overflow-hidden">
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-10"></div>
                    <div className="max-w-4xl mx-auto px-4 relative z-10">
                        <div className="text-center mb-12">
                            <span className="inline-flex items-center gap-2 bg-indigo-500/20 text-indigo-200 px-4 py-1 rounded-full text-sm font-semibold mb-4 border border-indigo-500/30">
                                <SparklesIcon /> מופעל על ידי Gemini AI
                            </span>
                            <h2 className="text-3xl md:text-4xl font-bold mb-4">העוזר האישי של נדיה</h2>
                            <p className="text-indigo-100 max-w-2xl mx-auto">
                                טכנולוגיה בשירות הנפש. השתמשו בבינה מלאכותית כדי לנתח סיטואציות מורכבות או לנסח תגובות ששומרות עליכם.
                            </p>
                        </div>

                        <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 md:p-8 border border-white/10 shadow-2xl">
                            {/* Tabs */}
                            <div className="flex gap-4 mb-6 border-b border-white/10 pb-4">
                                <button 
                                    onClick={() => { setActiveTab("analyze"); setResult(""); setInput(""); }}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${activeTab === "analyze" ? "bg-indigo-600 text-white" : "text-indigo-200 hover:bg-white/5"}`}
                                >
                                    <BrainIcon /> ניתוח מניפולציות
                                </button>
                                <button 
                                    onClick={() => { setActiveTab("greyrock"); setResult(""); setInput(""); }}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg transition ${activeTab === "greyrock" ? "bg-slate-600 text-white" : "text-indigo-200 hover:bg-white/5"}`}
                                >
                                    <ShieldIcon /> מחולל "אבן אפורה"
                                </button>
                            </div>

                            {/* Input Area */}
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm text-indigo-200 mb-2">
                                        {activeTab === "analyze" 
                                            ? "הדביקו כאן הודעה שקיבלתם או תארו סיטואציה:" 
                                            : "תארו את הסיטואציה או ההודעה שעליה תרצו להגיב:"}
                                    </label>
                                    <textarea 
                                        value={input}
                                        onChange={(e) => setInput(e.target.value)}
                                        className="w-full bg-slate-800/50 border border-slate-600 rounded-xl p-4 text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition h-32"
                                        placeholder={activeTab === "analyze" ? "לדוגמה: 'את תמיד מגזימה, אף אחד אחר לא חושב כמוך...'" : "לדוגמה: הוא מאשים אותי שלא איכפת לי ממנו כי יצאתי עם חברות..."}
                                    ></textarea>
                                </div>

                                <button 
                                    onClick={activeTab === "analyze" ? handleAnalyze : handleGreyRock}
                                    disabled={loading || !input.trim()}
                                    className={`w-full py-3 rounded-xl font-bold text-lg shadow-lg flex justify-center items-center gap-2 transition ${loading || !input.trim() ? "opacity-50 cursor-not-allowed bg-gray-600" : "bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 transform hover:-translate-y-1"}`}
                                >
                                    {loading ? (
                                        <>
                                            <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            מעבד נתונים...
                                        </>
                                    ) : (
                                        <>
                                            <SparklesIcon /> {activeTab === "analyze" ? "נתח את ההודעה" : "צור תגובות אבן אפורה"}
                                        </>
                                    )}
                                </button>
                                {!apiKey && (
                                    <p className="text-center text-yellow-300 text-sm cursor-pointer hover:underline" onClick={() => setShowSettings(true)}>⚠️ עליך להגדיר מפתח API בהגדרות כדי שהכפתור יעבוד</p>
                                )}
                            </div>

                            {/* Result Area */}
                            {result && (
                                <div className="mt-8 bg-slate-800/80 rounded-xl p-6 border border-indigo-500/30 animate-fadeIn">
                                    <h3 className="text-lg font-bold text-indigo-300 mb-3 flex items-center gap-2">
                                        <BotIcon /> {activeTab === "analyze" ? "ניתוח ה-AI:" : "הצעות לתגובה:"}
                                    </h3>
                                    <div className="prose prose-invert prose-p:text-slate-300 max-w-none whitespace-pre-wrap leading-relaxed">
                                        {result}
                                    </div>
                                    <div className="mt-4 text-xs text-slate-500 text-center">
                                        * התשובות נוצרו על ידי בינה מלאכותית ועשויות לכלול אי-דיוקים. השתמשו בשיקול דעת.
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </section>
            );
        };

        const FAQSection = () => {
            const [active, setActive] = React.useState(null);
            const toggle = (index) => setActive(active === index ? null : index);

            return (
                <section id="faq" className="py-20 bg-white">
                    <div className="max-w-3xl mx-auto px-4">
                        <h2 className="text-3xl font-bold text-slate-900 mb-12 text-center">שאלות קשות, תשובות כנות</h2>
                        <div className="space-y-4">
                            {faqs.map((faq, index) => (
                                <div key={index} className="border border-slate-200 rounded-lg overflow-hidden">
                                    <button 
                                        className="w-full text-right px-6 py-4 flex justify-between items-center bg-slate-50 hover:bg-slate-100 transition"
                                        onClick={() => toggle(index)}
                                    >
                                        <span className="font-semibold text-slate-800">{faq.q}</span>
                                        <span className={`transform transition-transform duration-200 text-blue-600 ${active === index ? 'rotate-180' : ''}`}>
                                            ▼
                                        </span>
                                    </button>
                                    {active === index && (
                                        <div className="px-6 py-4 bg-white text-slate-600 leading-relaxed border-t border-slate-100 animate-fadeIn">
                                            {faq.a}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </section>
            );
        };

        const ContactSection = () => {
            const { contactEmail, setShowSettings } = React.useContext(AppContext);
            const [status, setStatus] = React.useState("idle"); // idle, submitting, success, error

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!contactEmail) {
                    alert("אנא הגדר את כתובת האימייל שלך בהגדרות (סמל גלגל השיניים למעלה) כדי לקבל הודעות.");
                    setShowSettings(true);
                    return;
                }

                setStatus("submitting");

                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());

                // Using FormSubmit.co AJAX API
                try {
                    const response = await fetch(`https://formsubmit.co/ajax/${contactEmail}`, {
                        method: "POST",
                        headers: { 
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            ...data,
                            _subject: `הודעה חדשה מהאתר: ${data.name}`,
                            _captcha: "false" // Disable captcha for cleaner UX if possible, enable if spam occurs
                        })
                    });

                    if (response.ok) {
                        setStatus("success");
                        e.target.reset();
                    } else {
                        setStatus("error");
                    }
                } catch (error) {
                    console.error("Form error:", error);
                    setStatus("error");
                }
            };

            return (
                <section id="contact" className="py-20 bg-slate-50 border-t border-slate-200">
                    <div className="max-w-3xl mx-auto px-4">
                        <div className="text-center mb-12">
                            <h2 className="text-3xl font-bold text-slate-900 mb-4">יצירת קשר עם נדיה</h2>
                            <p className="text-slate-600">
                                אני כאן בשביל להקשיב. השאירו פרטים ואחזור אליכם בהקדם האפשרי.
                            </p>
                            {!contactEmail && (
                                <p className="text-amber-600 text-sm mt-2 font-medium bg-amber-50 inline-block px-3 py-1 rounded-full cursor-pointer" onClick={() => setShowSettings(true)}>
                                    ⚠️ שים לב: טרם הגדרת אימייל לקבלת הודעות. לחץ כאן להגדרות.
                                </p>
                            )}
                        </div>
                        <div className="bg-white rounded-xl shadow-xl p-8 border border-slate-100 relative overflow-hidden">
                            {status === "success" ? (
                                <div className="text-center py-12 animate-fadeIn">
                                    <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                    </div>
                                    <h3 className="text-2xl font-bold text-slate-800 mb-2">ההודעה נשלחה בהצלחה!</h3>
                                    <p className="text-slate-600 mb-6">תודה שפנית אלינו. נחזור אליך בהקדם.</p>
                                    <button onClick={() => setStatus("idle")} className="text-blue-600 font-medium hover:underline">שלח הודעה נוספת</button>
                                </div>
                            ) : (
                                <form className="space-y-6" onSubmit={handleSubmit}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">שם מלא</label>
                                            <input name="name" type="text" className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-slate-50" placeholder="השם שלך" required />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">טלפון</label>
                                            <input name="phone" type="tel" className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-slate-50" placeholder="050-0000000" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">אימייל</label>
                                        <input name="email" type="email" className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-slate-50" placeholder="email@example.com" required />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">הודעה</label>
                                        <textarea name="message" rows="4" className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition bg-slate-50" placeholder="במה אפשר לעזור?..." required></textarea>
                                    </div>
                                    
                                    <button 
                                        type="submit" 
                                        disabled={status === "submitting"}
                                        className={`w-full bg-blue-600 text-white font-bold py-4 rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-500/30 flex justify-center items-center gap-2 ${status === "submitting" ? "opacity-75 cursor-not-allowed" : ""}`}
                                    >
                                        {status === "submitting" ? "שולח..." : <><MailIcon /> שליחת הודעה</>}
                                    </button>
                                    
                                    {status === "error" && (
                                        <p className="text-red-500 text-center text-sm bg-red-50 p-2 rounded">
                                            אירעה שגיאה בשליחת ההודעה. אנא ודא שהגדרת אימייל תקין בהגדרות ונסה שוב.
                                        </p>
                                    )}
                                </form>
                            )}
                        </div>
                    </div>
                </section>
            );
        };

        const ScrollToTop = () => {
            const [visible, setVisible] = React.useState(false);

            React.useEffect(() => {
                const toggleVisibility = () => {
                    if (window.pageYOffset > 300) {
                        setVisible(true);
                    } else {
                        setVisible(false);
                    }
                };

                window.addEventListener("scroll", toggleVisibility);
                return () => window.removeEventListener("scroll", toggleVisibility);
            }, []);

            const scrollToTop = () => {
                window.scrollTo({
                    top: 0,
                    behavior: "smooth"
                });
            };

            if (!visible) return null;

            return (
                <button 
                    onClick={scrollToTop}
                    className="fixed bottom-6 left-6 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition z-40 animate-fadeIn"
                    aria-label="גלול למעלה"
                >
                    <ChevronUpIcon />
                </button>
            );
        };

        const Footer = () => {
            return (
                <footer className="bg-slate-900 text-slate-400 py-12 border-t border-slate-800">
                    <div className="max-w-7xl mx-auto px-4 text-center">
                        <div className="mb-6 flex justify-center items-center gap-2">
                             <ShieldIcon /> <span className="font-bold text-white text-xl">נדיה - הזכות להיות אני</span>
                        </div>
                        <p className="mb-6 text-sm max-w-lg mx-auto">
                            אתר זה נועד לספק מידע בלבד ואינו מהווה תחליף לייעוץ פסיכולוגי או רפואי מקצועי.
                            אם אתם נמצאים במערכת יחסים פוגענית, אנא פנו לעזרה מקצועית.
                        </p>
                        <div className="text-sm">
                            &copy; {new Date().getFullYear()} נדיה - הזכות להיות אני. כל הזכויות שמורות.
                        </div>
                    </div>
                </footer>
            );
        };

        const App = () => {
            // Get initial values from local storage
            const [apiKey, setApiKey] = React.useState(() => localStorage.getItem("gemini_api_key") || "");
            const [contactEmail, setContactEmail] = React.useState(() => localStorage.getItem("contact_email") || "");
            const [showSettings, setShowSettings] = React.useState(false);

            // Save to local storage whenever they change
            React.useEffect(() => {
                if (apiKey) localStorage.setItem("gemini_api_key", apiKey);
                if (contactEmail) localStorage.setItem("contact_email", contactEmail);
            }, [apiKey, contactEmail]);

            return (
                <AppContext.Provider value={{ apiKey, setApiKey, contactEmail, setContactEmail, showSettings, setShowSettings }}>
                    <div className="min-h-screen flex flex-col">
                        <Header />
                        <main className="flex-grow">
                            <Hero />
                            <TopicsSection />
                            <AIToolsSection />
                            <FAQSection />
                            <ContactSection />
                        </main>
                        <Footer />
                        <SettingsModal />
                        <ScrollToTop />
                    </div>
                </AppContext.Provider>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>